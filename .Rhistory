Pourcentage = format_number(100 * Effectif / sum(Effectif), 1),
Variable = var_label
) %>%
rename(Modalite = 1) %>%
select(Variable, Modalite, Effectif, Pourcentage)
# Ajouter une ligne de total
total_row <- data.frame(
Variable = var_label,
Modalite = "TOTAL",
Effectif = sum(table_data$Effectif),
Pourcentage = "100,0"
)
table_data <- rbind(table_data, total_row)
# Ajouter attribut pour le titre du tableau
attr(table_data, "tableau_title") <- tableau_title
} else {
# Pour les variables numériques
stats <- data %>%
summarise(
N = sum(!is.na(.data[[var_name]])),
Moyenne = format_number(mean(.data[[var_name]], na.rm = TRUE), 2),
Mediane = format_number(median(.data[[var_name]], na.rm = TRUE), 2),
EcartType = format_number(sd(.data[[var_name]], na.rm = TRUE), 2),
Min = min(.data[[var_name]], na.rm = TRUE),
Max = max(.data[[var_name]], na.rm = TRUE),
Manquants = sum(is.na(.data[[var_name]]))
)
table_data <- data.frame(
Variable = var_label,
Modalite = c("N", "Moyenne", "Médiane", "Écart-type", "Minimum", "Maximum", "Manquants"),
Effectif = c(stats$N, stats$Moyenne, stats$Mediane, stats$EcartType, stats$Min, stats$Max, stats$Manquants),
Pourcentage = ""
)
# Ajouter attribut pour le titre du tableau
attr(table_data, "tableau_title") <- tableau_title
}
return(table_data)
}
# Fonction pour créer des graphiques
create_plot <- function(data, var_name) {
if(is.factor(data[[var_name]]) || is.character(data[[var_name]])) {
# Variables catégorielles
plot_data <- data %>%
count(.data[[var_name]], name = "Effectif") %>%
mutate(Pourcentage = round(100 * Effectif / sum(Effectif), 1)) %>%
arrange(desc(Effectif)) %>%
slice_head(n = 10)  # Top 10 pour lisibilité
var_label <- get_var_label(var_name)
p <- ggplot(plot_data, aes(x = reorder(.data[[var_name]], Effectif), y = Effectif)) +
geom_bar(stat = "identity", fill = "#2E86AB", alpha = 0.8) +
geom_text(aes(label = paste0(Effectif, " (", Pourcentage, "%)")),
hjust = -0.1, size = 3) +
coord_flip() +
theme_minimal() +
labs(title = paste("Distribution :", var_label),
x = var_label,
y = "Effectif") +
theme(plot.title = element_text(size = 12, face = "bold"))
} else {
# Variables numériques
var_label <- get_var_label(var_name)
p <- ggplot(data, aes(x = .data[[var_name]])) +
geom_histogram(bins = 20, fill = "#2E86AB", alpha = 0.8, color = "white") +
geom_vline(aes(xintercept = median(.data[[var_name]], na.rm = TRUE)),
color = "red", linetype = "dashed", size = 1) +
theme_minimal() +
labs(title = paste("Distribution :", var_label),
x = var_label,
y = "Fréquence") +
theme(plot.title = element_text(size = 12, face = "bold"))
}
return(p)
}
# Charger le dataset nettoyé
load("donnees_nettoyees.RData")
# Informations générales
cat("Nombre de participants :", nrow(data), "\n")
cat("Nombre de variables :", ncol(data), "\n")
cat("Période de collecte : Juillet à Octobre 2025\n")
vars_id <- c("OPERATOR_ID", "CODE", "NUM_QUESTIONNAIRE", "DATE_ENQUETE", "HEURE_ENQUETE")
for(var in vars_id) {
if(var %in% names(data)) {
cat("\n### ", get_var_label(var), "\n")
if(var %in% c("DATE_ENQUETE", "HEURE_ENQUETE")) {
# Traitement spécial pour les dates
unique_vals <- length(unique(data[[var]]))
cat("Nombre de valeurs uniques :", unique_vals, "\n")
if(var == "DATE_ENQUETE") {
date_range <- range(as.Date(data[[var]], format = "%d-%m-%Y"), na.rm = TRUE)
cat("Période de collecte : du", format(date_range[1], "%d/%m/%Y"),
"au", format(date_range[2], "%d/%m/%Y"), "\n")
}
} else {
table_data <- create_freq_table(data, var, var)
if(nrow(table_data) <= 20) {
print(flextable(table_data) %>%
set_caption(paste("Distribution :", get_var_label(var))) %>%
autofit())
} else {
cat("Variable avec", nrow(table_data), "modalités différentes\n")
cat("Top 10 des modalités les plus fréquentes :\n")
top10 <- table_data %>% arrange(desc(Effectif)) %>% slice_head(n = 10)
print(flextable(top10) %>%
set_caption(paste("Top 10 :", get_var_label(var))) %>%
autofit())
}
}
}
}
vars_socio <- c("SEXE", "AGE", "CLASSES_AGE", "NIV_EDUC", "NB_PERS_CHARGE",
"CATEGORIE", "SITUATION_PROF", "TEMPS_TRAVAIL")
all_tables <- list()
for(var in vars_socio) {
if(var %in% names(data)) {
cat("\n## ", get_var_label(var), "\n")
# Créer le tableau
table_data <- create_freq_table(data, var, var)
all_tables[[var]] <- table_data
# Afficher le tableau avec titre du plan d'analyse
tableau_title <- attr(table_data, "tableau_title")
if(is.null(tableau_title)) {
tableau_title <- paste("Distribution :", get_var_label(var))
}
ft <- flextable(table_data) %>%
set_caption(tableau_title) %>%
autofit() %>%
theme_vanilla()
print(ft)
# Créer le graphique si pas trop de modalités
if(is.factor(data[[var]]) || is.character(data[[var]])) {
n_unique <- length(unique(data[[var]]))
if(n_unique <= 15) {
print(create_plot(data, var))
}
} else {
print(create_plot(data, var))
}
cat("\n")
}
}
vars_geo <- c("REGION_MILITAIRE", "SITE")
for(var in vars_geo) {
if(var %in% names(data)) {
cat("\n## ", get_var_label(var), "\n")
table_data <- create_freq_table(data, var, var)
if(var == "SITE") {
# Pour les sites, montrer le top 15
cat("Nombre total de sites :", nrow(table_data), "\n")
table_data <- table_data %>% arrange(desc(Effectif)) %>% slice_head(n = 15)
cat("Top 15 des sites :\n")
}
# Utiliser le titre du plan d'analyse
tableau_title <- get_tableau_title(var)
ft <- flextable(table_data) %>%
set_caption(tableau_title) %>%
autofit() %>%
theme_vanilla()
print(ft)
# Graphique pour région militaire seulement
if(var == "REGION_MILITAIRE") {
print(create_plot(data, var))
}
cat("\n")
}
}
vars_relations <- c("REL_INTIME_ACTU", "PARTENAIRE_PVVIH", "GRP_SOUTIEN_VIH", "BESOINS_FOND")
for(var in vars_relations) {
if(var %in% names(data)) {
cat("\n## ", get_var_label(var), "\n")
table_data <- create_freq_table(data, var, var)
ft <- flextable(table_data) %>%
set_caption(paste("Distribution de", var)) %>%
autofit() %>%
theme_vanilla()
print(ft)
print(create_plot(data, var))
cat("\n")
}
}
vars_depistage <- c("DECISION_DEPIST", "RAISON_PRINC", "HESITATION_DEPIST", "DELAI_DEBUT_TTT")
for(var in vars_depistage) {
if(var %in% names(data)) {
cat("\n## ", get_var_label(var), "\n")
table_data <- create_freq_table(data, var, var)
ft <- flextable(table_data) %>%
set_caption(paste("Distribution de", var)) %>%
autofit() %>%
theme_vanilla()
print(ft)
n_unique <- ifelse(is.factor(data[[var]]) || is.character(data[[var]]),
length(unique(data[[var]])), 1)
if(n_unique <= 10) {
print(create_plot(data, var))
}
cat("\n")
}
}
vars_sante <- c("ACCES_CV_12M", "IMPR_ETAT_SANTE", "DIAG_TB", "DIAG_HV", "DIAG_IST",
"DIAG_TB_MENT", "DIAG_MNT", "DIAG_IOP", "DIAG_ALC_DRG", "DIAG_PEC")
for(var in vars_sante) {
if(var %in% names(data)) {
cat("\n## Variable :", var, "\n")
table_data <- create_freq_table(data, var, var)
ft <- flextable(table_data) %>%
set_caption(paste("Distribution de", var)) %>%
autofit() %>%
theme_vanilla()
print(ft)
cat("\n")
}
}
vars_services <- c("SOINS_NON_VIH", "SITE_PEC_VIH", "SERV_TTT", "SERV_INFO", "SERV_DEP",
"SERV_SOUTIEN", "SERV_PREV", "SERV_CONSEIL", "SERV_DOSSIERS")
for(var in vars_services) {
if(var %in% names(data)) {
cat("\n## Variable :", var, "\n")
table_data <- create_freq_table(data, var, var)
ft <- flextable(table_data) %>%
set_caption(paste("Distribution de", var)) %>%
autofit() %>%
theme_vanilla()
print(ft)
cat("\n")
}
}
vars_exclusion <- c("EXCL_ACT_SOCIAL", "EXCL_ACT_RELIG", "EXCL_ACT_FAML", "EXCL_CRIT_FAM",
"EXCL_CRIT_AUTRES", "EXCL_HARCEL_VERB", "EXCL_CHANTAGE", "EXCL_HARC_PHYS",
"EXCL_REFUS_EMPLOI", "EXCL_TRAVAIL_POSTE", "EXCL_DISCR_CONJ_ENFTS")
cat("## Synthèse des variables d'exclusion sociale\n")
exclusion_summary <- data.frame(
Variable = character(),
Oui_Effectif = numeric(),
Oui_Pourcentage = numeric(),
stringsAsFactors = FALSE
)
for(var in vars_exclusion) {
if(var %in% names(data)) {
table_data <- data %>%
count(.data[[var]], name = "Effectif") %>%
mutate(Pourcentage = round(100 * Effectif / sum(Effectif), 1))
oui_row <- table_data %>% filter(grepl("Oui", .data[[var]], ignore.case = TRUE))
if(nrow(oui_row) > 0) {
exclusion_summary <- rbind(exclusion_summary,
data.frame(
Variable = var,
Oui_Effectif = oui_row$Effectif[1],
Oui_Pourcentage = format_number(oui_row$Pourcentage[1], 1)
))
}
}
}
# Ajouter une ligne de total
total_exclusion <- data.frame(
Variable = "TOTAL VARIABLES",
Oui_Effectif = nrow(exclusion_summary),
Oui_Pourcentage = paste0(nrow(exclusion_summary), " variables")
)
exclusion_summary <- rbind(exclusion_summary, total_exclusion)
exclusion_summary <- exclusion_summary %>% arrange(desc(Oui_Pourcentage))
ft_exclusion <- flextable(exclusion_summary) %>%
set_caption(get_tableau_title("SYNTHESE_EXCLUSION")) %>%
set_header_labels(
Variable = "Variable",
Oui_Effectif = "Effectif 'Oui'",
Oui_Pourcentage = "Pourcentage 'Oui'"
) %>%
autofit() %>%
theme_vanilla()
print(ft_exclusion)
vars_stigma_sante <- c("STIG_SERV_SAN_REFUS", "STIG_PAS_RAPPORT", "STIG_CRIT", "STIG_VIOLEN_VERB",
"STIG_VIOLEN_PHYS", "STIG_CONTACT_PHYS", "STIG_INFO_SANS_CONS", "REVEL_STATUT")
cat("## Synthèse de la stigmatisation dans les services de santé\n")
stigma_summary <- data.frame(
Variable = character(),
Oui_Effectif = numeric(),
Oui_Pourcentage = numeric(),
stringsAsFactors = FALSE
)
for(var in vars_stigma_sante) {
if(var %in% names(data)) {
table_data <- data %>%
count(.data[[var]], name = "Effectif") %>%
mutate(Pourcentage = round(100 * Effectif / sum(Effectif), 1))
oui_row <- table_data %>% filter(grepl("Oui", .data[[var]], ignore.case = TRUE))
if(nrow(oui_row) > 0) {
stigma_summary <- rbind(stigma_summary,
data.frame(
Variable = var,
Oui_Effectif = oui_row$Effectif[1],
Oui_Pourcentage = format_number(oui_row$Pourcentage[1], 1)
))
}
}
}
# Ajouter une ligne de total
total_stigma <- data.frame(
Variable = "TOTAL VARIABLES",
Oui_Effectif = nrow(stigma_summary),
Oui_Pourcentage = paste0(nrow(stigma_summary), " variables")
)
stigma_summary <- rbind(stigma_summary, total_stigma)
stigma_summary <- stigma_summary %>% arrange(desc(Oui_Pourcentage))
ft_stigma <- flextable(stigma_summary) %>%
set_caption(get_tableau_title("SYNTHESE_STIGMA_SANTE")) %>%
set_header_labels(
Variable = "Variable",
Oui_Effectif = "Effectif 'Oui'",
Oui_Pourcentage = "Pourcentage 'Oui'"
) %>%
autofit() %>%
theme_vanilla()
print(ft_stigma)
vars_sante_mentale <- c("SANTE_REFUS_SERV", "SANTE_REFUS_DENT", "SANTE_EVITER_RAPPORT",
"SANTE_COMMEN_NEG", "SANTE_VIOLEN_VERB", "SANTE_VIOLEN_PHYS",
"SANTE_ABS_CONTACT", "SANTE_DIVUL_STATUT", "VECU_STIGMA")
for(var in vars_sante_mentale) {
if(var %in% names(data)) {
cat("\n## Variable :", var, "\n")
table_data <- create_freq_table(data, var, var)
ft <- flextable(table_data) %>%
set_caption(paste("Distribution de", var)) %>%
autofit() %>%
theme_vanilla()
print(ft)
cat("\n")
}
}
vars_resilience <- c("RESS_CONF_SOI", "RESS_RESPECT_MOI", "RESS_RESPECT_AUTRES", "RESS_GEST_STRESS",
"RESS_TRV_AMOUR", "RESS_REAL_OBJ", "RESS_CAP_CONTRIB_COMM", "RESS_PRAT_RELIGION")
cat("## Synthèse des variables de résilience\n")
for(var in vars_resilience) {
if(var %in% names(data)) {
cat("\n### Variable :", var, "\n")
table_data <- create_freq_table(data, var, var)
ft <- flextable(table_data) %>%
set_caption(paste("Distribution de", var)) %>%
autofit() %>%
theme_vanilla()
print(ft)
cat("\n")
}
}
vars_choix <- c("CHOIX_PAS_RENC", "CHOIX_EVITER_HOPI", "CHOIX_PAS_POSTU_EMPL",
"CHOIX_PAS_SOUTIEN_SOCIAL", "CHOIX_EVITER_FAM_AMIS", "CHOIX_PAS_SEXE")
cat("## Synthèse des comportements d'évitement\n")
choix_summary <- data.frame(
Variable = character(),
Oui_Effectif = numeric(),
Oui_Pourcentage = numeric(),
stringsAsFactors = FALSE
)
for(var in vars_choix) {
if(var %in% names(data)) {
table_data <- data %>%
count(.data[[var]], name = "Effectif") %>%
mutate(Pourcentage = round(100 * Effectif / sum(Effectif), 1))
oui_row <- table_data %>% filter(grepl("Oui", .data[[var]], ignore.case = TRUE))
if(nrow(oui_row) > 0) {
choix_summary <- rbind(choix_summary,
data.frame(
Variable = var,
Oui_Effectif = oui_row$Effectif[1],
Oui_Pourcentage = format_number(oui_row$Pourcentage[1], 1)
))
}
}
}
# Ajouter une ligne de total
total_choix <- data.frame(
Variable = "TOTAL VARIABLES",
Oui_Effectif = nrow(choix_summary),
Oui_Pourcentage = paste0(nrow(choix_summary), " variables")
)
choix_summary <- rbind(choix_summary, total_choix)
choix_summary <- choix_summary %>% arrange(desc(Oui_Pourcentage))
ft_choix <- flextable(choix_summary) %>%
set_caption(get_tableau_title("SYNTHESE_EVITEMENT")) %>%
set_header_labels(
Variable = "Variable",
Oui_Effectif = "Effectif 'Oui'",
Oui_Pourcentage = "Pourcentage 'Oui'"
) %>%
autofit() %>%
theme_vanilla()
print(ft_choix)
vars_opinions <- c("OPIN_DIF_PARLER_SEROP", "OPIN_ETRE_SALE", "OPIN_COUPABLE",
"OPIN_HONTE", "OPIN_INUTILE", "OPIN_CACHE_SEROP")
for(var in vars_opinions) {
if(var %in% names(data)) {
cat("\n## Variable :", var, "\n")
table_data <- create_freq_table(data, var, var)
ft <- flextable(table_data) %>%
set_caption(paste("Distribution de", var)) %>%
autofit() %>%
theme_vanilla()
print(ft)
cat("\n")
}
}
vars_traitement <- c("DEBUT_TTT", "DUREE_TTT", "AUTRES_TTT", "PHYTOTHERAPIE", "DUREE_OUBLI_TTT")
for(var in vars_traitement) {
if(var %in% names(data)) {
cat("\n## Variable :", var, "\n")
if(var %in% c("DUREE_TTT", "DUREE_OUBLI_TTT")) {
# Variables numériques
table_data <- create_freq_table(data, var, var)
ft <- flextable(table_data) %>%
set_caption(paste("Statistiques descriptives de", var)) %>%
autofit() %>%
theme_vanilla()
print(ft)
print(create_plot(data, var))
} else {
# Variables catégorielles
table_data <- create_freq_table(data, var, var)
ft <- flextable(table_data) %>%
set_caption(paste("Distribution de", var)) %>%
autofit() %>%
theme_vanilla()
print(ft)
}
cat("\n")
}
}
vars_adherence <- c("ADHERENCE_S_SCORE_1", "FREQUENCE_OUBLI", "ADHERENCE_S_SCORE_2",
"FREQUENCE_PRISE_TTT", "ADHERENCE_S_SCORE_3", "SCORE_SUBJECTIF",
"ADHERENCE_SUBJECTIVE", "PTS_OBSERVANCE_SUBJECT", "SUIVI_CV_12M",
"ADHERENCE_OBJECTIVE", "PTS_OBSERVANCE_OBJECTIVE", "SCORE_OBSERVANCE_GLOB",
"OBSERVANCE_GLOBALE")
for(var in vars_adherence) {
if(var %in% names(data)) {
cat("\n## Variable :", var, "\n")
table_data <- create_freq_table(data, var, var)
ft <- flextable(table_data) %>%
set_caption(paste("Distribution de", var)) %>%
autofit() %>%
theme_vanilla()
print(ft)
if(is.numeric(data[[var]])) {
print(create_plot(data, var))
}
cat("\n")
}
}
vars_raisons <- c("RAISON1_PEUR_DECOUV_STAT", "RAISON1_CRAINT_PROFSANTE", "RAISON1_REFUS_TTT",
"RAISON1_PAS_PRET", "RAISON2_EFF_SECOND", "RAISON2_PB_APPRO_ARV",
"RAISON2_OUBLI", "RAISON2_MANQ_INFO", "RAISON2_DIFF_ACCES_TTT",
"RAISON2_FACT_PSYCHO", "RAISON2_POLYMEDICATION", "RAISONS_AUTRES")
cat("## Synthèse des raisons de non-adhérence\n")
raisons_summary <- data.frame(
Variable = character(),
Oui_Effectif = numeric(),
Oui_Pourcentage = numeric(),
stringsAsFactors = FALSE
)
for(var in vars_raisons) {
if(var %in% names(data)) {
table_data <- data %>%
count(.data[[var]], name = "Effectif") %>%
mutate(Pourcentage = round(100 * Effectif / sum(Effectif), 1))
oui_row <- table_data %>% filter(grepl("Oui", .data[[var]], ignore.case = TRUE))
if(nrow(oui_row) > 0) {
raisons_summary <- rbind(raisons_summary,
data.frame(
Variable = var,
Oui_Effectif = oui_row$Effectif[1],
Oui_Pourcentage = format_number(oui_row$Pourcentage[1], 1)
))
}
}
}
# Ajouter une ligne de total
total_raisons <- data.frame(
Variable = "TOTAL VARIABLES",
Oui_Effectif = nrow(raisons_summary),
Oui_Pourcentage = paste0(nrow(raisons_summary), " variables")
)
raisons_summary <- rbind(raisons_summary, total_raisons)
raisons_summary <- raisons_summary %>% arrange(desc(Oui_Pourcentage))
ft_raisons <- flextable(raisons_summary) %>%
set_caption(get_tableau_title("SYNTHESE_RAISONS_NON_ADHERENCE")) %>%
set_header_labels(
Variable = "Variable",
Oui_Effectif = "Effectif 'Oui'",
Oui_Pourcentage = "Pourcentage 'Oui'"
) %>%
autofit() %>%
theme_vanilla()
print(ft_raisons)
cat("# SYNTHÈSE GÉNÉRALE DE L'ENQUÊTE\n")
cat("================================\n\n")
cat("## Échantillon\n")
cat("- Nombre de participants :", nrow(data), "\n")
cat("- Nombre de variables analysées :", ncol(data), "\n")
cat("- Période de collecte : Juillet à Octobre 2025\n\n")
cat("## Profil sociodémographique\n")
cat("- Âge moyen :", format_number(mean(data$AGE, na.rm = TRUE), 1), " ans\n")
femmes_pct <- format_number(100 * mean(data$SEXE == "Féminin", na.rm = TRUE), 1)
cat("- Proportion de femmes :", femmes_pct, "%\n")
civil_pct <- format_number(100 * mean(data$CATEGORIE == "Civil", na.rm = TRUE), 1)
cat("- Personnel civil :", civil_pct, "%\n")
educ_sup_pct <- format_number(100 * mean(data$NIV_EDUC %in% c("Ecole secondaire / Lycée / Equivalent local", "Université / Enseignement supérieur"), na.rm = TRUE), 1)
cat("- Niveau secondaire ou supérieur :", educ_sup_pct, "%\n\n")
cat("## Traitement ARV\n")
cat("- Durée moyenne de traitement :", format_number(mean(data$DUREE_TTT, na.rm = TRUE), 1), " mois\n")
cat("- Durée médiane :", format_number(median(data$DUREE_TTT, na.rm = TRUE), 1), " mois\n\n")
cat("## Répartition géographique\n")
region1_pct <- format_number(100 * mean(data$REGION_MILITAIRE == "1ère Région Militaire", na.rm = TRUE), 1)
cat("- 1ère Région Militaire :", region1_pct, "%\n")
hma_pct <- format_number(100 * mean(data$SITE == "HMA", na.rm = TRUE), 1)
cat("- Site HMA :", hma_pct, "%\n")
cat("\n*Rapport généré le", format(Sys.Date(), "%d/%m/%Y"), "*\n")
